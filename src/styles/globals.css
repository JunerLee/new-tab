@import './accessibility.css';
@import './neumorphic.css';
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  * {
    @apply border-claude-gray-200 dark:border-claude-gray-700;
  }
  
  body {
    @apply bg-claude-cream dark:bg-claude-dark text-claude-gray-800 dark:text-claude-gray-200;
    @apply font-sans antialiased;
    @apply transition-colors duration-300;
  }
  
  html {
    @apply scroll-smooth;
  }
}

@layer components {
  /* ===========================================
     拟物化设计系统核心组件
     =========================================== */
  
  /* 基础拟物化表面 */
  .neumorphic-surface {
    @apply bg-claude-cream dark:bg-claude-dark;
    @apply shadow-neumorphic dark:shadow-neumorphic-dark;
    @apply border-0 rounded-2xl;
    @apply transition-all duration-300 ease-out;
  }
  
  /* 纸质卡片效果 */
  .paper-card {
    @apply bg-claude-cream/95 dark:bg-claude-gray-900/95;
    @apply backdrop-blur-sm;
    @apply shadow-neumorphic dark:shadow-neumorphic-dark;
    @apply border border-white/20 dark:border-white/10;
    @apply rounded-2xl;
    @apply transition-all duration-300 ease-out;
  }
  
  .paper-card:hover {
    @apply shadow-float dark:shadow-float-dark;
    @apply -translate-y-1 scale-[1.01];
    @apply border-white/30 dark:border-white/15;
  }
  
  /* 模态框专用 - 解决白天模式可见性问题 */
  .modal-surface {
    @apply bg-white/95 dark:bg-claude-gray-900/95;
    @apply backdrop-blur-xl;
    @apply shadow-modal dark:shadow-modal-dark;
    @apply border-2 border-claude-gray-300/60 dark:border-white/15;
    @apply rounded-3xl;
    /* 确保白天模式下有足够的对比度 */
    box-shadow: 
      0 24px 64px rgba(0, 0, 0, 0.15), 
      0 12px 32px rgba(0, 0, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.5);
  }
  
  .dark .modal-surface {
    box-shadow: 
      0 24px 64px rgba(0, 0, 0, 0.8), 
      0 12px 32px rgba(0, 0, 0, 0.6),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }
  
  /* ===========================================
     按钮系统
     =========================================== */
  
  /* 主要拟物化按钮 */
  .neumorphic-button {
    @apply relative;
    @apply bg-claude-cream dark:bg-claude-gray-800;
    @apply shadow-neumorphic-sm dark:shadow-neumorphic-sm-dark;
    @apply border-0 rounded-2xl;
    @apply transition-all duration-200 ease-out;
    @apply cursor-pointer;
    /* 添加内部高光效果 */
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%, rgba(0, 0, 0, 0.05) 100%);
  }
  
  .dark .neumorphic-button {
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.05) 0%, transparent 50%, rgba(0, 0, 0, 0.2) 100%);
  }
  
  .neumorphic-button:hover {
    @apply shadow-neumorphic dark:shadow-neumorphic-dark;
    @apply -translate-y-0.5;
    @apply scale-[1.02];
  }
  
  .neumorphic-button:active {
    @apply shadow-inset-sm dark:shadow-inset-sm-dark;
    @apply translate-y-0 scale-[0.98];
  }
  
  /* 小尺寸按钮 */
  .neumorphic-button-sm {
    @apply neumorphic-button;
    @apply shadow-soft dark:shadow-soft;
    @apply rounded-xl;
  }
  
  /* 大尺寸按钮 */
  .neumorphic-button-lg {
    @apply neumorphic-button;
    @apply shadow-neumorphic-lg dark:shadow-neumorphic-lg-dark;
    @apply rounded-3xl;
  }
  
  /* ===========================================
     输入框系统
     =========================================== */
  
  /* 搜索输入框 - 修复圆角问题 */
  .search-input {
    @apply w-full px-6 py-4;
    @apply bg-claude-cream/90 dark:bg-claude-gray-800/90;
    @apply shadow-inset dark:shadow-inset-dark;
    @apply border-0;
    @apply placeholder-claude-gray-500 dark:placeholder-claude-gray-400;
    @apply text-lg font-medium;
    @apply transition-all duration-300 ease-out;
    @apply backdrop-blur-sm;
    /* 强制圆角在所有状态下保持一致 */
    border-radius: 1rem !important;
    -webkit-border-radius: 1rem !important;
    -moz-border-radius: 1rem !important;
  }
  
  .search-input:focus {
    @apply outline-none;
    @apply shadow-neumorphic dark:shadow-neumorphic-dark;
    @apply bg-claude-cream dark:bg-claude-gray-800;
    @apply scale-[1.01];
    /* 确保焦点时也保持圆角 */
    border-radius: 1rem !important;
    -webkit-border-radius: 1rem !important;
    -moz-border-radius: 1rem !important;
  }
  
  /* 标准输入框 */
  .neumorphic-input {
    @apply bg-claude-cream dark:bg-claude-gray-800;
    @apply shadow-inset-sm dark:shadow-inset-sm-dark;
    @apply border-0 rounded-xl px-4 py-3;
    @apply transition-all duration-200 ease-out;
  }
  
  .neumorphic-input:focus {
    @apply outline-none shadow-neumorphic-sm dark:shadow-neumorphic-sm-dark;
  }
  
  /* ===========================================
     快速启动系统
     =========================================== */
  
  .quick-launch-item {
    @apply relative;
    @apply flex flex-col items-center justify-center;
    @apply w-20 h-20 rounded-2xl;
    @apply bg-claude-cream/95 dark:bg-claude-gray-800/95;
    @apply shadow-neumorphic-sm dark:shadow-neumorphic-sm-dark;
    @apply border border-white/20 dark:border-white/10;
    @apply cursor-pointer;
    @apply transition-all duration-300 ease-out;
    @apply backdrop-blur-sm;
    /* 添加微妙的内部高光 */
    background: linear-gradient(
      145deg,
      rgba(255, 255, 255, 0.1) 0%,
      transparent 50%,
      rgba(0, 0, 0, 0.05) 100%
    ), var(--neuma-bg-light);
  }
  
  .dark .quick-launch-item {
    background: linear-gradient(
      145deg,
      rgba(255, 255, 255, 0.05) 0%,
      transparent 50%,
      rgba(0, 0, 0, 0.2) 100%
    ), var(--neuma-bg-dark);
  }
  
  .quick-launch-item:hover {
    @apply shadow-float dark:shadow-float-dark;
    @apply -translate-y-1 scale-105; /* 轻微减小缩放效果 */
    @apply border-white/30 dark:border-white/15;
    /* 悬停时增强高光 */
    background: linear-gradient(
      145deg,
      rgba(255, 255, 255, 0.15) 0%,
      transparent 50%,
      rgba(0, 0, 0, 0.05) 100%
    ), var(--neuma-bg-light);
  }
  
  .dark .quick-launch-item:hover {
    background: linear-gradient(
      145deg,
      rgba(255, 255, 255, 0.08) 0%,
      transparent 50%,
      rgba(0, 0, 0, 0.2) 100%
    ), var(--neuma-bg-dark);
  }
  
  .quick-launch-item:active {
    @apply shadow-inset-sm dark:shadow-inset-sm-dark;
    @apply translate-y-0 scale-[0.98];
    /* 点击时的凹陷效果 */
    background: linear-gradient(
      145deg,
      rgba(0, 0, 0, 0.1) 0%,
      transparent 50%,
      rgba(255, 255, 255, 0.05) 100%
    ), var(--neuma-bg-light);
  }
  
  .dark .quick-launch-item:active {
    background: linear-gradient(
      145deg,
      rgba(0, 0, 0, 0.3) 0%,
      transparent 50%,
      rgba(255, 255, 255, 0.02) 100%
    ), var(--neuma-bg-dark);
  }
  
  /* iOS风格编辑模式样式 */
  .quick-launch-edit-mode {
    @apply transition-all duration-300 ease-out;
  }
  
  .quick-launch-edit-mode .quick-launch-item {
    @apply relative;
    transform-origin: center center;
  }
  
  .quick-launch-wiggle {
    animation: wiggle 0.6s ease-in-out infinite alternate;
  }
  
  @keyframes wiggle {
    0% { 
      transform: rotate(-0.5deg) translateY(-1px); 
    }
    25% { 
      transform: rotate(0.5deg) translateX(1px); 
    }
    50% { 
      transform: rotate(-0.3deg) translateY(1px); 
    }
    75% { 
      transform: rotate(0.3deg) translateX(-1px); 
    }
    100% { 
      transform: rotate(-0.2deg) translateY(-0.5px); 
    }
  }
  
  /* 编辑模式按钮样式 */
  .edit-control-button {
    @apply absolute w-6 h-6 rounded-full flex items-center justify-center;
    @apply text-white text-xs font-bold shadow-lg z-20;
    @apply transition-all duration-200 ease-out;
    @apply transform-gpu;
  }
  
  .edit-control-button:hover {
    @apply scale-110;
  }
  
  .edit-control-button:active {
    @apply scale-95;
  }
  
  /* 拖拽状态样式 */
  .quick-launch-dragging {
    @apply opacity-50 scale-95;
    @apply pointer-events-none;
    @apply z-50;
  }
  
  .quick-launch-drag-over {
    @apply scale-110 ring-2 ring-green-400 ring-opacity-70;
    @apply shadow-float dark:shadow-float-dark;
    @apply z-10;
  }
  
  /* 长按反馈动画 */
  .quick-launch-pressing {
    @apply scale-95;
    @apply shadow-inset-sm dark:shadow-inset-sm-dark;
  }
  
  /* 确保触摸设备上的交互 */
  @media (hover: none) and (pointer: coarse) {
    .quick-launch-item {
      @apply select-none;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
  }

  /* ===========================================
     滑块和开关系统
     =========================================== */
  
  /* 拟物化滑块 */
  .neumorphic-slider {
    -webkit-appearance: none;
    appearance: none;
    @apply relative w-full h-2 rounded-full;
    @apply bg-claude-cream dark:bg-claude-gray-800;
    @apply shadow-inset dark:shadow-inset-dark;
    @apply cursor-pointer;
    @apply transition-all duration-200;
  }
  
  .neumorphic-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    @apply w-6 h-6 rounded-full;
    @apply bg-claude-cream dark:bg-claude-gray-700;
    @apply shadow-neumorphic-sm dark:shadow-neumorphic-sm-dark;
    @apply cursor-pointer;
    @apply transition-all duration-200;
    border: 2px solid rgba(255, 255, 255, 0.3);
  }
  
  .dark .neumorphic-slider::-webkit-slider-thumb {
    border: 2px solid rgba(255, 255, 255, 0.1);
  }
  
  .neumorphic-slider::-webkit-slider-thumb:hover {
    @apply shadow-float dark:shadow-float-dark;
    @apply scale-110;
  }
  
  /* Firefox 兼容性 */
  .neumorphic-slider::-moz-range-thumb {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--neuma-bg-light);
    box-shadow: 
      4px 4px 8px var(--neuma-shadow-light),
      -4px -4px 8px var(--neuma-highlight-light);
    border: 2px solid rgba(255, 255, 255, 0.3);
    cursor: pointer;
  }
  
  .dark .neumorphic-slider::-moz-range-thumb {
    background: var(--neuma-bg-dark);
    box-shadow: 
      4px 4px 8px var(--neuma-shadow-dark),
      -4px -4px 8px var(--neuma-highlight-dark);
    border: 2px solid rgba(255, 255, 255, 0.1);
  }
  
  /* ===========================================
     玻璃态效果
     =========================================== */
  
  .glass-effect {
    @apply bg-white/20 dark:bg-black/20;
    @apply backdrop-blur-xl;
    @apply border border-white/30 dark:border-white/15;
    @apply rounded-2xl;
    @apply shadow-medium;
  }
  
  /* 强化玻璃态 - 用于重要元素 */
  .glass-effect-strong {
    @apply bg-white/40 dark:bg-black/40;
    @apply backdrop-blur-2xl;
    @apply border-2 border-white/40 dark:border-white/20;
    @apply rounded-3xl;
    @apply shadow-strong;
  }
  
  /* ===========================================
     工具类和效果
     =========================================== */
  
  .icon-wrapper {
    @apply w-8 h-8 rounded-xl;
    @apply flex items-center justify-center;
    @apply transition-all duration-200;
    @apply bg-gradient-to-br from-white/10 to-transparent;
  }
  
  .shimmer {
    @apply relative overflow-hidden;
  }
  
  .shimmer::after {
    @apply absolute inset-0;
    @apply bg-gradient-to-r from-transparent via-white/20 to-transparent;
    @apply animate-shimmer;
    content: '';
  }
  
  /* 悬浮效果增强器 */
  .hover-lift {
    @apply transition-all duration-300 ease-out;
  }
  
  .hover-lift:hover {
    @apply -translate-y-1 shadow-float dark:shadow-float-dark;
  }
  
  /* 渐变背景 */
  .gradient-bg {
    background: linear-gradient(
      135deg,
      rgba(251, 248, 245, 0.95) 0%,
      rgba(247, 246, 245, 0.9) 50%,
      rgba(239, 237, 233, 0.95) 100%
    );
  }
  
  .dark .gradient-bg {
    background: linear-gradient(
      135deg,
      rgba(15, 15, 15, 0.95) 0%,
      rgba(28, 28, 28, 0.9) 50%,
      rgba(42, 40, 36, 0.95) 100%
    );
  }
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
  
  .text-pretty {
    text-wrap: pretty;
  }
  
  /* 透明度工具类 */
  .apply-opacity {
    opacity: var(--bg-opacity, 1);
  }
  
  /* 动态模糊 */
  .apply-blur {
    filter: blur(var(--bg-blur, 0px));
  }
  
  /* 拟物化复选框 */
  .neumorphic-checkbox {
    @apply appearance-none w-5 h-5 rounded-lg;
    @apply bg-claude-cream dark:bg-claude-gray-800;
    @apply shadow-inset-sm dark:shadow-inset-sm-dark;
    @apply border-0 cursor-pointer;
    @apply transition-all duration-200 ease-out;
    @apply relative;
  }
  
  .neumorphic-checkbox:checked {
    @apply shadow-neumorphic-sm dark:shadow-neumorphic-sm-dark;
    @apply bg-claude-gray-200 dark:bg-claude-gray-700;
  }
  
  .neumorphic-checkbox:checked::after {
    content: '✓';
    @apply absolute inset-0 flex items-center justify-center;
    @apply text-claude-gray-700 dark:text-claude-gray-300 text-sm font-bold;
  }
}

/* ===========================================
   特殊效果和彩蛋功能
   =========================================== */

/* 彩虹背景动画 */
@keyframes rainbowBackground {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.rainbow-bg {
  background: linear-gradient(
    45deg,
    #ff6b6b,
    #ffa500,
    #ffff00,
    #32cd32,
    #1e90ff,
    #9370db,
    #ff6b6b
  );
  background-size: 400% 400%;
  animation: rainbowBackground 5s ease infinite;
}

/* 星空背景效果 */
.starry-bg {
  background: radial-gradient(2px 2px at 40% 30%, #fff, transparent),
              radial-gradient(2px 2px at 80% 60%, #fff, transparent),
              radial-gradient(1px 1px at 20% 80%, #fff, transparent),
              radial-gradient(1px 1px at 90% 10%, #fff, transparent),
              radial-gradient(2px 2px at 60% 20%, #fff, transparent);
  animation: sparkle 3s ease-in-out infinite;
}

@keyframes sparkle {
  0%, 100% { opacity: 0.7; }
  50% { opacity: 1; }
}

/* 粒子效果容器 */
.particles-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9999;
  overflow: hidden;
}

/* 单个粒子样式 */
.particle {
  position: absolute;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  pointer-events: none;
}

/* 心形粒子（特殊日期使用） */
.heart-particle {
  position: absolute;
  width: 12px;
  height: 12px;
  pointer-events: none;
}

.heart-particle::before,
.heart-particle::after {
  content: '';
  position: absolute;
  left: 6px;
  top: 0;
  width: 6px;
  height: 10px;
  background: #ff69b4;
  border-radius: 6px 6px 0 0;
  transform: rotate(-45deg);
  transform-origin: 0 100%;
}

.heart-particle::after {
  left: 0;
  transform: rotate(45deg);
  transform-origin: 100% 100%;
}

/* 成功反馈动画 */
.success-ripple {
  position: absolute;
  border: 2px solid #10b981;
  border-radius: 50%;
  width: 0;
  height: 0;
  animation: ripple 0.6s ease-out;
  pointer-events: none;
}

@keyframes ripple {
  0% {
    width: 0;
    height: 0;
    opacity: 1;
  }
  100% {
    width: 40px;
    height: 40px;
    opacity: 0;
    margin: -20px;
  }
}